@attribute [Route(Routes.Contract)]
@inherits FluxorComponent

<MudStack Class="pa-4">
    <MudStack Row AlignItems="AlignItems.End">
        <MudText Typo="Typo.h3">@($"{ContractDto?.Type} contract")</MudText>
        <MudSpacer />
        @if (ContractDto != null)
        {
            <CommandMenu OnCommandMenuItemSelected="@(_ => CommandMenuItemSelected(_, ContractDto))"
                         Items="@_commandMenuItems" />
        }
    </MudStack>

    @if (ContractState.Value.IsLoading)
    {
        <MudProgressCircular Indeterminate
                             Class="ma-auto"
        Size="Size.Large" />
    }
    else if (ContractDto != null)
    {
        <MudText Typo="Typo.h6">@(ContractDto.Accepted ? "Accepted" : "Not acccepted")</MudText>

        @if (!ContractDto.Accepted)
        {
            <MudText Typo="Typo.h6">@($"On accepted: ₡{ContractDto.Terms.Payment.AcceptedCredits}")</MudText>
        }
        <MudText Typo="Typo.h6">@($"On fulfilled: ₡{ContractDto.Terms.Payment.FulfilledCredits}")</MudText>

        <MudText Typo="Typo.subtitle2">Goods to deliver</MudText>
        <MudTable Items="@ContractDto.Terms.ContractDeliverGoods">
            <HeaderContent>
                <MudTh>Name</MudTh>
                <MudTh>Destination</MudTh>
                <MudTh>Progress</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Name">
                    <MudText Typo="Typo.body2">@context.TradeSymbol</MudText>
                </MudTd>
                <MudTd DataLabel="Destination">
                    <MudLink Href="@RouteHelpers.Waypoint(WaypointsHelpers.GetSystemFromWaypoint(context.DestinationSymbol), context.DestinationSymbol)" Typo="Typo.body2">@context.DestinationSymbol</MudLink>
                </MudTd>
                <MudTd DataLabel="Progress">
                    <MudText Typo="Typo.body2">@($"{context.UnitsFulfilled}/{context.UnitsRequired}")</MudText>
                </MudTd>
            </RowTemplate>
        </MudTable>
    }
</MudStack>